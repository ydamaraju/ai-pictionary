<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Sketch Learner</title>
        <script src="js/p5.min.js"></script>
        <script src="js/ml5.min.js"></script>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background: #f0f0f0; }
        canvas { border: 2px solid #333; background: white; cursor: crosshair; margin-top: 20px; }
        .controls { margin: 20px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
        button { padding: 10px 15px; cursor: pointer; border-radius: 5px; border: none; background: #007bff; color: white; }
        button:hover { background: #0056b3; }
        #status { font-weight: bold; color: #555; }
        .prediction-area { font-size: 1.5rem; margin: 10px; color: #2c3e50; }
    </style>
</head>
<body>

    <h2>AI Sketch Recognizer</h2>
    <p id="status">Loading Model...</p>
    
    <div class="prediction-area">
        I think this is: <span id="resultText">...</span>
    </div>

    <div id="canvas-container"></div>

    <div class="controls">
        <input type="text" id="labelInput" placeholder="Enter label (e.g. 'Circle')">
        <button onclick="addExample()">Add as Example</button>
        <button onclick="train()">Train Model</button>
        <button onclick="clearCanvas()" style="background:#6c757d">Clear Drawing</button>
    </div>

    <script>
let classifier;
let canvas;

function setup() {
    // Create a 400x400 canvas
    canvas = createCanvas(400, 400);
    canvas.parent('canvas-container');
    background(255);

    // FIX: Use imageClassifier with { training: true } instead of featureExtractor
    classifier = ml5.imageClassifier('MobileNet', { training: true }, modelLoaded);
}

function modelLoaded() {
    document.getElementById('status').innerText = 'Model Ready (v1.x)! Label and add examples.';
}

function draw() {
    if (mouseIsPressed) {
        stroke(0);
        strokeWeight(12);
        line(mouseX, mouseY, pmouseX, pmouseY);
    }
}

function addExample() {
    const label = document.getElementById('labelInput').value;
    if (!label) return alert("Please enter a label!");

    // FIX: Use addData instead of addImage
    classifier.addData(canvas, label);
    document.getElementById('status').innerText = `Added a "${label}" example.`;
}

function train() {
    document.getElementById('status').innerText = 'Training... please wait.';
    // Training remains similar but handles the new internal structure
    classifier.train(whileTraining);
}

function whileTraining(loss) {
    if (loss === null) {
        document.getElementById('status').innerText = 'Training Complete! Guessing...';
        startGuessing();
    }
}

function startGuessing() {
    // Classify the current canvas
    classifier.classify(canvas, gotResults);
}

function gotResults(results) {
    if (results && results[0]) {
        // results[0].label is the name you gave, confidence is 0.0 to 1.0
        let label = results[0].label;
        let conf = (results[0].confidence * 100).toFixed(1);
        document.getElementById('resultText').innerText = `${label} (${conf}%)`;
    }
    // Loop to keep guessing
    classifier.classify(canvas, gotResults);
}

function clearCanvas() {
    background(255);
}
    </script>
</body>
</html>